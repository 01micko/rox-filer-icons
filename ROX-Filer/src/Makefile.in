SHELL = @SHELL@
srcdir = @srcdir@
PLATFORM = @with_platform@
PLATFORM_DIR = ../${PLATFORM}
CC = @CC@
.SUFFIXES:
.SUFFIXES: .c .o

PKG_CONFIG = @PKG_CONFIG@
LIBS = @LIBS@ @LFS_LDFLAGS@ -lICE -lSM
#PROF = -fprofile-arcs -pg

CFLAGS = ${PROF} @CFLAGS@ @LFS_CFLAGS@ \
	 `${PKG_CONFIG} --cflags gtk+-2.0 libxml-2.0`
LDFLAGS = ${PROF} @LDFLAGS@ ${LIBS} `${PKG_CONFIG} --libs gtk+-2.0 libxml-2.0`
EXEC = ${PLATFORM_DIR}/${PROG}

############ Things to change for different programs

PROG = ROX-Filer

SRCS = abox.c action.c appinfo.c appmenu.c bind.c bookmarks.c		\
	cell_icon.c choices.c collection.c dir.c diritem.c display.c	\
	dnd.c dropbox.c filer.c find.c fscache.c gtksavebox.c		\
	gui_support.c i18n.c icon.c infobox.c main.c menu.c minibuffer.c\
	modechange.c mount.c options.c panel.c pinboard.c pixmaps.c	\
	remote.c rox_gettext.c run.c sc.c session.c support.c 		\
	tasklist.c toolbar.c type.c usericons.c view_collection.c	\
	view_details.c view_iface.c wrapped.c xml.c

OBJECTS = abox.o action.o appinfo.o appmenu.o bind.o bookmarks.o	\
	cell_icon.o choices.o collection.o dir.o diritem.o display.o	\
	dnd.o dropbox.o filer.o find.o fscache.o gtksavebox.o		\
	gui_support.o i18n.o icon.o infobox.o main.o menu.o minibuffer.o\
	modechange.o mount.o options.o panel.o pinboard.o pixmaps.o	\
	remote.o rox_gettext.o run.o sc.o session.o support.o		\
	tasklist.o toolbar.o type.o usericons.o view_collection.o	\
	view_details.o view_iface.o wrapped.o xml.o

############ Things to keep the same

${EXEC}: ${PLATFORM_DIR} ${OBJECTS}
	${CC} -o ${EXEC} ${OBJECTS} ${LDFLAGS}

${PLATFORM_DIR}:
	mkdir ${PLATFORM_DIR}

clean:
	rm -f *.o Makefile.bak

depend:
	makedepend -- ${CFLAGS} -- ${SRCS}

Makefile: Makefile.in config.status
	./config.status

config.h: config.h.in
	./config.status

config.status: configure
	./configure --with-platform="${PLATFORM}" --enable-rox

configure: configure.in
	autoconf

messages.pot: ${SRCS} ../Options.xml
	python po/tips.py
	xgettext --keyword=_ --keyword=N_ --output=$@ ${SRCS} tips
